<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Komik Generator</title>

<!-- LIBRARY PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  font-family: 'Comic Sans MS', cursive;
  background: #eee;
  padding: 10px;
}

h1 {
  text-align: center;
}

#controls {
  background: white;
  padding: 10px;
  border-radius: 10px;
  margin-bottom: 15px;
}

select, input, textarea, button {
  width: 100%;
  padding: 8px;
  margin-top: 5px;
}

#comic {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 10px;
}

.panel {
  position: relative;
  border: 3px solid black;
  background: white;
}

.panel img {
  width: 100%;
  display: block;
}

.bubble {
  position: absolute;
  bottom: 10px;
  max-width: 80%;
  background: white;
  border: 2px solid black;
  padding: 5px;
  font-size: 13px;
  border-radius: 10px;
}

.left {
  left: 5px;
}

.right {
  right: 5px;
}

.anime {
  filter: saturate(1.3) contrast(1.1);
}

.manga {
  filter: grayscale(1) contrast(1.5);
}
</style>
</head>
<body>

<h1>ðŸ“– Komik Generator Anime</h1>

<div id="controls">

<select id="character">
  <option value="https://i.imgur.com/8Km9tLL.png">Anime Cowok</option>
  <option value="https://i.imgur.com/QrKRV6A.png">Anime Cewek</option>
  <option value="https://i.imgur.com/Z7AzH2c.png">Chibi</option>
</select>

<input type="file" id="upload" accept="image/*">

<textarea id="dialog" placeholder="Dialog karakter..."></textarea>

<select id="bubble">
  <option value="left">Bubble Kiri</option>
  <option value="right">Bubble Kanan</option>
</select>

<select id="style">
  <option value="">Normal</option>
  <option value="anime">Anime</option>
  <option value="manga">Manga</option>
</select>

<button onclick="addPanel()">âž• Tambah Panel</button>
<button onclick="exportPDF()">ðŸ“„ Export ke PDF</button>

</div>

<div id="comic"></div>

<script>
let uploadedImage = null;

document.getElementById("upload").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => uploadedImage = reader.result;
  reader.readAsDataURL(file);
});

function addPanel() {
  const dialog = document.getElementById("dialog").value;
  const bubble = document.getElementById("bubble").value;
  const style = document.getElementById("style").value;

  if (!dialog) {
    alert("Dialog belum diisi!");
    return;
  }

  const imgSrc = uploadedImage || document.getElementById("character").value;

  const panel = document.createElement("div");
  panel.className = "panel " + style;

  panel.innerHTML = `
    <img src="${imgSrc}">
    <div class="bubble ${bubble}">${dialog}</div>
  `;

  document.getElementById("comic").appendChild(panel);
  document.getElementById("dialog").value = "";
  uploadedImage = null;
}

async function exportPDF() {
  const comic = document.getElementById("comic");
  const canvas = await html2canvas(comic, {scale: 2});
  const imgData = canvas.toDataURL("image/png");

  const pdf = new jspdf.jsPDF("p", "mm", "a4");
  const w = pdf.internal.pageSize.getWidth();
  const h = canvas.height * w / canvas.width;

  pdf.addImage(imgData, "PNG", 0, 0, w, h);
  pdf.save("komik-saya.pdf");
}
</script>

</body>
</html>